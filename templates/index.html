<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Ferramenta de PDF</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- Script JavaScript para altern√¢ncia de tema e manipula√ß√£o de arquivos -->
    <script>
        let uploadedFiles = {}; // Armazena os arquivos carregados

        // Alterna entre os modos claro e escuro
        function toggleTheme() {
            document.body.classList.toggle("dark-mode");
        }

        // Fun√ß√£o para exibir o campo CPF apenas quando "Buscar Comprovantes" √© selecionado
        function handleActionSelection() {
            const actionSelect = document.querySelector('select[name="action"]');
            const cpfContainer = document.getElementById('cpf-container');
            const instructionMessage = document.querySelector('.pdf-instruction');

            if (actionSelect.value === "comprovantes") {
                cpfContainer.style.display = 'block';
                instructionMessage.style.display = 'block';
            } else {
                cpfContainer.style.display = 'none';
                instructionMessage.style.display = 'none';
            }
        }

        // Fun√ß√£o para exibir a mensagem de sucesso e mostrar o arquivo carregado
        function handleFileUpload(event) {
            const fileInput = event.target;
            const fileName = fileInput.files[0].name;
            const fileKey = fileInput.name;

            // Armazena o arquivo carregado
            uploadedFiles[fileKey] = fileName;

            // Atualiza a lista de arquivos exibida
            updateFileList();
        }

        // Fun√ß√£o para atualizar a lista de arquivos exibida
        function updateFileList() {
            const fileList = document.getElementById('file-list');
            fileList.innerHTML = '';

            for (const [key, fileName] of Object.entries(uploadedFiles)) {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `${fileName} <button onclick="removeFile('${key}')">Excluir</button>`;
                fileList.appendChild(fileItem);
            }
        }

        // Fun√ß√£o para remover um arquivo carregado
        function removeFile(fileKey) {
            delete uploadedFiles[fileKey];
            updateFileList();

            // Limpa o campo de upload correspondente
            const inputFile = document.querySelector(`input[name="${fileKey}"]`);
            if (inputFile) inputFile.value = '';
        }

        // Adiciona eventos de altera√ß√£o para o menu de sele√ß√£o e campos de upload de PDF e CPF
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('select[name="action"]').addEventListener('change', handleActionSelection);
            document.querySelector('input[name="pdf"]').addEventListener('change', handleFileUpload);
            document.querySelector('input[name="cpfs_file"]').addEventListener('change', handleFileUpload);
        });
    </script>
</head>
<body>
<!-- Barra de navega√ß√£o -->
<nav class="navbar">
    <div class="logo">Minha Ferramenta de PDF</div>
    <button onclick="toggleTheme()" class="toggle-theme">üåô Modo Escuro</button>
</nav>

<div class="container">
    <header>
        <h1>Ferramenta de PDF</h1>
    </header>

    <!-- Mensagens de instru√ß√£o e de sucesso -->
    <div class="pdf-instruction" style="display: none;">
        <strong>Como funciona a busca de comprovantes:</strong>
        <ol>
            <li>Adicione um arquivo PDF que contenha v√°rias p√°ginas com diferentes documentos.</li>
            <li>Crie um arquivo texto (.txt) com os CPFs, cada um em uma linha.</li>
            <li>Fa√ßa o upload do arquivo PDF e do arquivo de CPFs.</li>
        </ol>
        <p>O programa ir√° separar o documento por cada CPF encontrado no arquivo PDF.</p>
    </div>

    <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data">
        <!-- Campo de upload para PDF -->
        <label class="custom-file-upload">
            <input type="file" name="pdf" accept=".pdf" required>
            Escolher PDF
        </label>

        <!-- Campo de upload para lista de CPFs (oculto at√© que "Buscar Comprovantes" seja selecionado) -->
        <div id="cpf-container" style="display: none;">
            <label class="custom-file-upload">
                <input type="file" name="cpfs_file" accept=".txt">
                Escolher Lista de CPFs
            </label>
        </div>

        <!-- Sele√ß√£o de a√ß√£o -->
        <select name="action">
            <option value="resumo">Gerar Resumo</option>
            <option value="comprovantes">Buscar Comprovantes</option>
        </select>

        <!-- Lista de arquivos carregados -->
        <div id="file-list" class="file-list"></div>

        <!-- Bot√£o de envio -->
        <button type="submit">Enviar</button>
    </form>

    <!-- Exibi√ß√£o do resumo e link para download do ZIP -->
    {% if summary %}
        <div class="summary">
            <h2>Resumo:</h2>
            <p>{{ summary }}</p>
        </div>
    {% endif %}

    {% if zip_file %}
        <a href="{{ url_for('download_zip') }}" class="download-link">Baixar Comprovantes ZIP</a>
    {% endif %}
</div>
</body>
</html>

